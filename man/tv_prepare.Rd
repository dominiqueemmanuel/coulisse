% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/timevis_log.R
\name{tv_prepare}
\alias{tv_prepare}
\title{Préparer les données pour \pkg{timevis} (barres, drapeaux & runtime de job)}
\usage{
tv_prepare(
  df,
  job_filter = NULL,
  lanes = c("manager", "worker", "session"),
  min_duration_ms = 5,
  palette = NULL,
  drop_session = FALSE,
  merge_pairs = TRUE,
  job_runtime_range = c("fail_only", "all", "none")
)
}
\arguments{
\item{df}{\code{data.frame} issu de \code{read_coulisse_log()}.}

\item{job_filter}{IDs de jobs à garder (ou \code{NULL}).}

\item{lanes}{Pistes à afficher (\code{c("manager","worker","session")} par défaut).}

\item{min_duration_ms}{Durée min (ms) pour afficher une barre ; en-dessous ⇒ point.}

\item{palette}{Liste pour surcharger les couleurs par catégorie (voir \code{.palette_cat()}).}

\item{drop_session}{Masquer la piste \code{"(session)"}.}

\item{merge_pairs}{Fusionner les paires \verb{*_start/_end}.}

\item{job_runtime_range}{\code{"fail_only"} (défaut), \code{"all"}, \code{"none"}.}
}
\value{
\verb{list(items = <data.frame>, groups = <data.frame>)} utilisable par \code{timevis::timevis()}.
}
\description{
\itemize{
\item Fusionne les paires \verb{*_start/_end} en barres avec bornes strictes ;
\item Convertit les événements ayant \code{dt_ms} en barres \verb{[ts - dt_ms ; ts]} (sans doubler des paires existantes) ;
\item Rend les événements ponctuels en drapeaux  avec trait vertical pointillé ;
\item Ajoute une \strong{barre "runtime de job"} \verb{[start → fin]} :
\itemize{
\item fin = dernière occurrence \code{done}/\code{error}/\code{timeout} côté manager \strong{ou} worker ;
\item si \code{done} (et \code{job_runtime_range="all"}), barre sur la piste \strong{manager} ;
\item si \code{error}/\code{timeout}, barre \strong{forcée sur la piste worker} ;
\item si les deux lanes finissent au même instant, on \strong{préfère worker}.
}
}
}
